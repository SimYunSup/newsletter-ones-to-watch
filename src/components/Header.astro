---
import Favicon from "@/assets/favicon.svg";
import styles from "@/styles/components/header.module.css";

const isHome = Astro.url.pathname.includes("/home");
const isNews = Astro.url.pathname === "/" || Astro.url.pathname.includes("/news");
const isAbout = Astro.url.pathname.includes("/about");
---

<header class={styles.header}>
  <div class={styles.container}>
    <div class={styles.left}>
      <a class={styles.logo} href="/home">
        <Favicon class={styles["logo-img"]}  />
        OTW <span class={styles["logo-sub"]}>for</span> FE
      </a>
      <nav class={styles["desktop-nav"]}>
        <a class={styles.link} href="/home" aria-current={isHome ? true : undefined}>
          Home
        </a>
        <a class={styles.link} href="/news/list/1" aria-current={isNews ? true : undefined}>
          News
        </a>
        <a class={styles.link} href="/about" aria-current={isAbout ? true : undefined}>
          About us
        </a>
      </nav>
    </div>
    <div class={styles.right}>
      <button id="theme-toggle" class={styles["theme-toggle"]} aria-label="Toggle dark mode">
        <svg id="theme-toggle-light-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="4"></circle>
          <path d="M12 2v2"></path>
          <path d="M12 20v2"></path>
          <path d="m4.93 4.93 1.41 1.41"></path>
          <path d="m17.66 17.66 1.41 1.41"></path>
          <path d="M2 12h2"></path>
          <path d="M20 12h2"></path>
          <path d="m6.34 17.66-1.41 1.41"></path>
          <path d="m19.07 4.93-1.41 1.41"></path>
        </svg>
        <svg id="theme-toggle-dark-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
        </svg>
      </button>
      <a class={styles["icon-link"]} href="https://github.com/SimYunSup/newsletter-ones-to-watch" target="_blank" rel="noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
          <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path>
          <path d="M9 18c-4.51 2-5-2-7-2"></path>
        </svg>
        <span class="sr-only">GitHub</span>
      </a>
      <a class={styles["icon-link"]} href="/rss.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
          <path d="M4 11a9 9 0 0 1 9 9"></path>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <circle cx="5" cy="19" r="1"></circle>
        </svg>
        <span class="sr-only">RSS Feed</span>
      </a>
      <button id="mobile-menu-button" class={styles["mobile-menu-button"]} aria-label="Toggle menu">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
      <script is:inline>
        // Theme toggle functionality
        function initTheme() {
          const themeToggle = document.querySelector("#theme-toggle");
          const lightIcon = document.querySelector("#theme-toggle-light-icon");
          const darkIcon = document.querySelector("#theme-toggle-dark-icon");

          // Get stored theme or default to 'light'
          const getStoredTheme = () => localStorage.getItem("theme") || "light";
          const setStoredTheme = (theme) => localStorage.setItem("theme", theme);

          // Apply theme to document
          const applyTheme = (theme) => {
            if (theme === "dark") {
              document.documentElement.setAttribute("data-theme", "dark");
              lightIcon.style.display = "none";
              darkIcon.style.display = "block";
            } else {
              document.documentElement.setAttribute("data-theme", "light");
              lightIcon.style.display = "block";
              darkIcon.style.display = "none";
            }
          };

          // Initialize theme on page load
          applyTheme(getStoredTheme());

          // Toggle theme on button click
          themeToggle?.addEventListener("click", () => {
            const currentTheme = getStoredTheme();
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            setStoredTheme(newTheme);
            applyTheme(newTheme);
          });
        }

        // Initialize on page load
        initTheme();

        // Re-initialize after navigation (for SPAs)
        document.addEventListener("astro:after-swap", initTheme);

        // Mobile menu toggle
        document.querySelector("#mobile-menu-button")?.addEventListener("click", () => {
          document.querySelector("#mobile-nav")?.classList.toggle("active");
        });
      </script>
    </div>
  </div>
  <div id="mobile-nav" class={styles["mobile-nav"]}>
    <a class={styles.link} href="/home" aria-current={isHome ? true : undefined}>
      Home
    </a>
    <a class={styles.link} href="/news/list/1" aria-current={isNews ? true : undefined}>
      News
    </a>
    <a class={styles.link} href="/about" aria-current={isAbout ? true : undefined}>
      About us
    </a>
  </div>
</header>